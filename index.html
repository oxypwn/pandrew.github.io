<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Blog | Paul Liljenberg</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="alternate" type="application/rss+xml" title="Paul Liljenbergs Blog" href="http://localhost:4000/feed/index.xml">
  <link rel="shortcut icon" href="http://www.gravatar.com/avatar/b2a4628e8eb9c7a8134f68098567049f.png
?s=16">
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/mobile.css">
  <link rel="stylesheet" href="/css/desktop.css" media="(min-width:40em)">
  <link rel="stylesheet" href="/css/pygments.css">
  <!--<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700|Ubuntu:300,500,300italic,500italic|Ubuntu+Condensed' rel='stylesheet' type='text/css'>-->
  <script type="text/javascript" charset="utf-8" src="/js/matchmedia.js"></script>
  <script type="text/javascript" charset="utf-8" src="/js/picturefill.js"></script>
</head>

<body>
<div class="wrapper">
    <header>
    <div class="container">
        <div class="profile">
            <div class="social">
                <a href="http://twitter.com/paul_andrew">
                    <div data-picture data-alt="Twitter">
                        <div data-src="/img/twitter16.png"></div>
                        <div data-src="/img/twitter32.png"     data-media="(-webkit-min-device-pixel-ratio: 2)"></div>
                        <noscript><img src="/img/twitter16.png" alt="Twitter"></noscript>
                    </div>
                </a>
                <a href="http://github.com/pandrew">
                    <div data-picture data-alt="Github">
                        <div data-src="/img/octocat16.png"></div>
                        <div data-src="/img/octocat32.png"     data-media="(-webkit-min-device-pixel-ratio: 2)"></div>
                        <noscript><img src="/img/octocat16.png" alt="Github"></noscript>
                    </div>
                </a>
            </div>
            <!--           <img src="http://www.gravatar.com/avatar/b2a4628e8eb9c7a8134f68098567049f.png
?s=54" alt="avatar" class="avatar" />
            <img src="http://www.gravatar.com/avatar/b2a4628e8eb9c7a8134f68098567049f.png
?s=108" alt="avatar" class="avatar-large" />
         -->
        </div>
        <h5 class="logo"><a href="http://borntobebash.zombieland.se">Paul Liljenberg</a></h5>
        <nav>
            <ul>
                
                    <li><a href="http://borntobebash.zombieland.se" class="active">Blog</a></li>
                
                
                <li><a href="http://borntobebash.zombieland.se/about">About</a></li>
                
                
                <li><a href="http://borntobebash.zombieland.se/projects">Projects</a></li>
                
            </ul>
        </nav>
        <div class="nav-slider">
            <div class="nav-selection blog"></div>
        </div>
    </div>
</header>


    <section id="main">
        <article class="container">
          
          
  
      <article class="post">
          <div class="post-header">
                <p class="date">Feb 05, 2014</p>
                <h1><a href="/post/enforcer">Enforcer</a></h1>
          </div>
          <div class="post-body">
            <p>It&#39;s time to tell you all what ive been working on for the last couple of months. Long before i started at Nackademin in Stockholm ive been looking at methods for installing and manage snapshots of both virtual and pysical machines. I needed to have a method for breaking an OS and being able to reinstall or get back to a certain state. I actually started this journey using clonezilla but this was a far from ideal solution for this. Next step is kickstarting where you give all the necessary options to the installer so it can install to a state without a user have to intervene. Next step is to add a provisioning tool. The result is something like:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">Install machine using a kickstart -&gt; What should the machine do when it&#39;s installed? (provisioning)
</code></pre></div>
<p>The two components is not easy to manage so i built a web application to manage kickstart-files for most systems. The app uses ipxe compatible scripts so any machine that ipxe can boot and install so can Enforcer. Normal operation in a network is; you enter a mac address for a machine and what os it should install. This becomes the profile for that machine. A profile can be as small as two settings; the mac and the template name. All clients that should be installed needs to be booted via network. For the machine to actually install you have to activate the profile. When the machine have retrieved the profile Enforcer will deactivate the profile. An admin can reinstall a machine just by activating profiles and reboot the machines.</p>

<h4 id="toc_0">What works?</h4>

<ul>
<li>  Applicatian and database is isolated by default.</li>
<li>  http and tls support.</li>
<li>  Insert template data into database.</li>
<li>  Booting from templates.</li>
</ul>

<h4 id="toc_1">Upcoming features</h4>

<ul>
<li>  Authentication of some sort.</li>
<li>  Edit templates from within app.</li>
<li>  Support BMC (ipmi).</li>
<li>  Search and tagging so you can activate groups of machines.</li>
</ul>

<h4 id="toc_2">Release</h4>

<p>Backend will be open source. Frontend is not yet ready for release.</p>

          </div>
      </article>
  

  
      <article class="post">
          <div class="post-header">
                <p class="date">Jan 19, 2014</p>
                <h1><a href="/post/final-updates-and-conclusion-for-this-course">Final updates and conclusion for this course</a></h1>
          </div>
          <div class="post-body">
            <p>This update is more a summary of the status of Arks - the unattended installation framework for Archlinux</p>

<p>So far the following new features have been implemented and is working in Arks:</p>

<ul>
<li>  Progrium/keychain.io support</li>
<li>  Email one-time passwords.</li>
<li>  Puppet provisioning.</li>
<li>  Notify your iPhone when installation is complete.</li>
<li>  Notify via email when an error occur.</li>
</ul>

<p>Besides this Arks has great error handling letting the user besides being notified when it has an error letting the user fix the problem right there in the middle of the installation. You don&#39;t have to start over. All nodes and users have their own profiles.  That way you can specify all users for one node and all users can have individual settings.  To help installation Arks tries to follow Beginners&#39; Guide. Arks installs a node below one minute and the time Arks spend is dependant on how much you cram in your machine.</p>

<h1 id="toc_0">Upcoming features</h1>

<ul>
<li>  Efi support.</li>
</ul>

<h1 id="toc_1">Conclusion</h1>

<p>These weeks I have been focusing on Arks and it has been intense.  Alongside Arks I have been experimenting with Apache Mesos and Marathon; diving into more advanced scripting techniques for installation. I really enjoy reading peoples code and this have helped me writing better code myself. Its not only about writing code, but all the different ways one simple application can be written just for the purpose of doing one simple thing. </p>

          </div>
      </article>
  

  
      <article class="post">
          <div class="post-header">
                <p class="date">Jan 13, 2014</p>
                <h1><a href="/post/control-arks-via-puppet">Control Arks via puppet</a></h1>
          </div>
          <div class="post-body">
            <p>In this status update iv&#39;e taken a look at puppet/chef integration. The first thing to understand is that both puppet and chef is in a high development state as both packages are only available in aur (the user repository for archlinux). I had no luck using the omnibus installer for chef as it cant be installed unattended from aur with packer. This leaves us to puppet.</p>

<p>Client and server installation is no biggies. Installing from aur gives no errors and using puppetlabs repos in any ubuntu/debian works like a charm. The issues iv&#39;e encountered where that the server (puppetmaster) had issues accepting the certificate from client if they where behind nat. To make demo scenarios easier the puppetmaster was installed in the cloud and the clients was supposed to talk to the server behind nat. It seems that the server need to have fqdn for both clients and itself to work. I dont think i would see the same type of error if every client had its own accessible domain. Putting the puppetmaster within the same net was more successfull. Cleaning up the old certs for client and server and the server recognices the certificate request.</p>

<p>Next step is creating a function that does something like this...</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">if PUPPET_SERVER is set
    install puppet
    if PUPPET_CONF is set
        curl PUPPET_CONF to /etc/puppet/puppet.conf
    else
        inject PUPPET_SERVER into /etc/puppet/puppet.conf
    fi
    start puppet agent on boot
fi
</code></pre></div>
<p>Todo:</p>

<ul>
<li>Build function</li>
<li>Test integration of server/client behind nat.</li>
</ul>

          </div>
      </article>
  

  
      <article class="post">
          <div class="post-header">
                <p class="date">Jan 03, 2014</p>
                <h1><a href="/post/arks-credentials-via-email">Arks: Credentials via email</a></h1>
          </div>
          <div class="post-body">
            <p>This update of Arks include a couple of bugs in the <code>user.sh</code> that affected multiple user logins. I&#39;ve also added a new function to handle adding multiple groups.
Now when we set <code>ADDTOGROUPS=&quot;users,sudo&quot;</code>; the function will look at /etc/group and add any non existent groups. </p>

<p>Arks is now able to send the credentials via email.</p>

<p>To enable this you need to have an api-key and a domain for mailgun. Set the <code>API_KEY_EMAIL</code> in your host profile. If you have set the <code>EMAIL</code> variable for a user arks will try to send you your password.</p>

<p>There are two new features to implement in Arks for this course:</p>

<h2 id="toc_0">Account passwords via mail [Implemented]</h2>

<p>The basic idea is that the users being added in the profile should have their passwords sent via email. These passwords is autogenerated and the user will be forced to update this
upon first login. I will use mailguns api to trigger the mailing function for every user being installed. With the demo account we can add upp to 300 users per day for a node. 
This should be fairly easy as all users have their own script. That way we can set each users email and we place the api key in the profile for the node.
If the api key is set it will email the user and if it&#39;s not it will set the password to the username.</p>

<h2 id="toc_1">Puppet/Chef integration</h2>

<p>This is the second step in the upgrade for Arks and it involves integrating Chef and/or Puppet into the system. If the <code>foo</code> is set it will trigger the installation of that particular block and
  talk to server <code>bar</code> for further instructions upon final reboot.</p>

<p>As server I will use either the Chef enterprise or the Puppet counterpart so we can be sure that we have a working server. They usually have support for upp to 5 or 10 nodes and should be enough
  for this project.</p>

          </div>
      </article>
  

  
      <article class="post">
          <div class="post-header">
                <p class="date">Dec 28, 2013</p>
                <h1><a href="/post/Arks">Arks: From block to solid rock!</a></h1>
          </div>
          <div class="post-body">
            <p>This is the first post for the <code>pandrew/arks</code> repository used to install archlinux unattendedly. From this momement this blog will be used
as a tool to document the progress for this project.</p>

<p>The older project <code>pandrew/ks</code> was intended to be multi-branched so when installing from an url it was looking at the branch for its code. That meant that each os had its own branch. 
I thought it was time for a change and give the installation system for archlinux a new repo of its own. This will make it easier to maintain fixes and not mix these with the other installation systems.</p>

<p>Last weeks updates has mostly been focused on updating documentation for the new repo. Besides documenting the profiles; there have also been some code review as it was quite  a while since
I installed archlinux using this system. The documentaion should also be more easily read using <a href="http://progrium.viewdocs.io/viewdocs">viewdocs.io</a> and you can read the docs <a href="http://pandrew.viewdocs.io/arks">here</a></p>

<p>There are two new features to implement in Arks for this course:</p>

<h3 id="toc_0">Account passwords via mail</h3>

<p>The basic idea is that the users being added in the profile should have their passwords sent via email. These passwords is autogenerated and the user will be forced to update this
upon first login. I will use mailguns api to trigger the mailing function for every user being installed. With the demo account we can add upp to 300 users per day for a node. 
This should be fairly easy as all users have their own script. That way we can set each users email and we place the api key in the profile for the node.
If the api key is set it will email the user and if it&#39;s not it will set the password to the username.</p>

<h3 id="toc_1">Puppet/Chef integration</h3>

<p>This is the second step in the upgrade for Arks and it involves integrating Chef and/or Puppet into the system. If the <code>foo</code> is set it will trigger the installation of that particular block and
talk to server <code>bar</code> for further instructions upon final reboot.</p>

<p>As server I will use either the Chef enterprise or the Puppet counterpart so we can be sure that we have a working server. They usually have support for upp to 5 or 10 nodes and should be enough
for this project.</p>

          </div>
      </article>
  


<!-- Pagination links -->
<div class="pagination">
  
  
</div>

        </article>
    </section>

    <footer>
    <nav class="container">
        <ul>
            <li>&copy; Paul Liljenberg 2013</li>
        </ul>
    </nav>
</footer>

</body>
<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33073396-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

</script>
<script type="text/javascript" charset="utf-8">
    document.onreadystatechange = function() {
        if ( document.readyState == 'complete' ) {
            var active = document.querySelector( 'header a.active' ).innerHTML.toLowerCase(),
                links = document.querySelectorAll( 'header nav li a'),
                selection = document.querySelector( 'header .nav-selection' ),
                i, link;
            for ( i = 0; i < links.length; i++ ) {
                link = links[ i ];
                console.log(link);
                link.addEventListener( 'mouseover', function() {
                    selection.className = 'nav-selection';
                    selection.className = 'nav-selection ' + this.innerHTML.toLowerCase();
                });
                link.addEventListener( 'mouseout', function() {
                    selection.className = 'nav-selection ' + active;
                });
            }
        }
    };
</script>

</html>
